waitUntil { !isNil "GRLIB_all_fobs" };
waitUntil { !isNil "save_is_loaded" };
[] call compileFinal preprocessFileLineNumbers "scripts\uke\planearmamentmanager.sqf";

FNC_ACTIVATE = {
	//_tplane2 = _this select 0;
	planeammo2="true";
	publicVariable "planeammo2";
	//_id1 = _tplane2 addAction ["Load Cluster Armament",FNC_RemoteClusters,nil,1.5,false,true,"","planeammo2=='true'",4];
	//_id2 = _tplane2 addAction ["Load GBU Armament",FNC_RemoteGBU,nil,1.5,false,true,"","planeammo2=='true'",4];
	//_id3 = _tplane2 addAction ["Load ATGM Armament",FNC_RemoteATGM,nil,1.5,false,true,"","planeammo2=='true'",4];
	//_id4 = _tplane2 addAction ["Load Interceptor Armament",FNC_RemoteIA,nil,1.5,false,true,"","planeammo2=='true'",4];
};

FNC_REMOTE_ACTIVATE = {
	_vehicle = _this select 0;
	[_vehicle] remoteExec ["FNC_ACTIVATE",0];
};




FNC_DEACTIVATE = {
	//_tplane2 = _this select 0;
	planeammo2="false";
	publicVariable "planeammo2";
	//removeAction[_id1];
	//removeAction[_id2];
	//removeAction[_id3];
	//removeAction[_id4];
};

FNC_REMOTE_DEACTIVATE = {
	_vehicle = _this select 0;
	[_vehicle] remoteExec ["FNC_DEACTIVATE",0];
};


	firstloop2 = true;
	plane2 = objNull;
	_savedplane = objNull;

	while { true } do {

		{
			if ( typeof _x == plane_typename && _x !=plane ) then {
				_savedplane = _x;
			};
		} foreach vehicles;

		if ( firstloop && !isNull _savedplane ) then {
			plane2 = _savedplane;
		} else {
			plane2 = plane_typename createVehicle (getposATL planespawn_1);
			plane2 enableSimulationGlobal false;
			plane2 allowdamage false;
			plane2 setPosATL (getposATL planespawn_1);
			plane2 setDir (getDir planespawn_1);

_id1 = objNull;
_id2 = objNull;
_id3 = objNull;
_id4 = objNull; 
_trigger = createTrigger["EmptyDetector",plane2,true];
_trig = _trigger attachTo [plane2,[0,0,0]];
_trigger setTriggerArea[20,20,0,false,20];
_trigger setTriggerActivation ["ANY","PRESENT",true];
//_trigger setTriggerStatements["ammocrate in thisList","[plane2] call FNC_REMOTE_ACTIVATE","[plane2] call FNC_REMOTE_DEACTIVATE"];
_trigger setTriggerStatements["ammocrate in thisList","FNC_ACTIVATE","FNC_DEACTIVATE"];
//_id1 = plane2 addAction ["Load Cluster Armament",FNC_RemoteClusters,nil,1.5,false,true,"","planeammo2=='true'",4];
//_id2 = plane2 addAction ["Load GBU Armament",FNC_RemoteGBU,nil,1.5,false,true,"","planeammo2=='true'",4];
//_id3 = plane2 addAction ["Load ATGM Armament",FNC_RemoteATGM,nil,1.5,false,true,"","planeammo2=='true'",4];
//_id4 = plane2 addAction ["Load Interceptor Armament",FNC_RemoteIA,nil,1.5,false,true,"","planeammo2=='true'",4];
// planeammo2 addPublicVariableEventHandler {if (planeammo2=="true") then {
// _id1 = plane2 addAction ["Load Cluster Armament",FNC_RemoteClusters,nil,1.5,false,true,"","",4];
// _id2 = plane2 addAction ["Load GBU Armament",FNC_RemoteGBU,nil,1.5,false,true,"","",4];
// _id3 = plane2 addAction ["Load ATGM Armament",FNC_RemoteATGM,nil,1.5,false,true,"","",4];
// _id4 = plane2 addAction ["Load Interceptor Armament",FNC_RemoteIA,nil,1.5,false,true,"","",4];
// } 
// else
// {
// 	removeAction _id1;
// 	removeAction _id2;
// 	removeAction _id3;
// 	removeAction _id4;
// };
};
		};

		firstloop2 = false;

	
		publicVariable "plane2";
		clearWeaponCargoGlobal plane2;
		clearMagazineCargoGlobal plane2; 
		clearItemCargoGlobal plane2;
		clearBackpackCargoGlobal plane2;
		plane2 setDamage 0;
		sleep 0.5;
		plane2 enableSimulationGlobal true;
		plane2 setDamage 0;
		plane2 setVariable ["ace_medical_medicClass", 1, true];
		sleep 1.5;

		plane2 setDamage 0;
		plane2 allowdamage true;

		if (KP_liberation_debug) then {private _text = format ["[KP LIBERATION] [DEBUG] plane spawned by: %1", debug_source];_text remoteExec ["diag_log",2];};

		if ( alive plane2 ) then {

			waitUntil {
				sleep 1;
				!alive plane2;
			};
			
			sleep 15;

		};

		if (plane2 distance startbase < 500) then {
			deletevehicle plane2;
		};
		sleep 0.25;
	
};